---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import { SITE_TITLE, SITE_DESCRIPTION } from '../consts';

const posts = (await getCollection('blog')).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

const formatDate = (date: Date) => {
	return date.toISOString().split('T')[0];
};
---

<BaseLayout title={SITE_TITLE} description={SITE_DESCRIPTION}>
	<p class="tagline"><span class="prompt">$</span> {SITE_DESCRIPTION}</p>

	<section class="posts">
		<h2 class="section-title"><span class="hash">#</span> RECENT POSTS</h2>

		{posts.length === 0 && <p class="empty">No posts yet.</p>}

		{posts.map((post) => (
			<a href={`/blog/${post.id}`} class="post">
				<div class="post-header">
					<h3 class="title">{post.data.title}</h3>
					<span class="date">{formatDate(post.data.pubDate)}</span>
				</div>
				<p class="description">{post.data.description}</p>
				{post.data.tags && post.data.tags.length > 0 && (
					<div class="tags">
						{post.data.tags.map((tag) => (
							<span class="tag">{tag}</span>
						))}
					</div>
				)}
			</a>
		))}
	</section>
</BaseLayout>

<style>
	.tagline {
		font-size: 1rem;
		color: var(--text-secondary);
		margin-bottom: 3rem;
	}

	.prompt {
		color: var(--accent-teal);
	}

	.section-title {
		font-size: 0.8rem;
		font-weight: 500;
		color: var(--text-muted);
		letter-spacing: 0.1em;
		margin-bottom: 2rem;
	}

	.hash {
		color: var(--accent-teal);
	}

	.posts {
		display: flex;
		flex-direction: column;
	}

	.empty {
		color: var(--text-muted);
	}

	.post {
		display: block;
		padding: 1.5rem 0;
		border-bottom: 1px solid var(--border);
		transition: border-color 0.2s ease;
	}

	.post:hover {
		border-bottom-color: var(--accent-teal);
	}

	.post:hover .title {
		color: var(--accent-teal);
	}

	.post-header {
		display: flex;
		justify-content: space-between;
		align-items: flex-start;
		gap: 1rem;
		margin-bottom: 0.5rem;
	}

	.title {
		font-size: 1rem;
		font-weight: 500;
		color: var(--text-primary);
		margin: 0;
		transition: color 0.2s ease;
	}

	.date {
		font-size: 0.8rem;
		color: var(--text-muted);
		white-space: nowrap;
	}

	.description {
		font-size: 0.875rem;
		color: var(--text-secondary);
		margin: 0 0 0.75rem 0;
		line-height: 1.5;
	}

	.tags {
		display: flex;
		flex-wrap: wrap;
		gap: 0.5rem;
	}

	.tag {
		font-size: 0.75rem;
		color: var(--accent-teal);
		background-color: var(--bg-tertiary);
		padding: 0.25rem 0.6rem;
		border-radius: 4px;
	}
</style>
